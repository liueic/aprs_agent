# APRS业余无线电音频控制系统使用说明

## 概述

本系统专为业余无线电APRS应用设计，通过计算机音频接口控制电台的音频输入输出，实现高质量的APRS信号处理。

## 硬件连接

### 基本连接方式
```
计算机音频输出 (耳机接口) → 音频线 → 电台音频输入
计算机音频输入 (麦克风接口) ← 音频线 ← 电台音频输出
```

### 推荐连接方案
1. **音频输出到电台**: 使用3.5mm转6.35mm音频线，连接计算机耳机输出到电台音频输入
2. **音频输入从电台**: 使用6.35mm转3.5mm音频线，连接电台音频输出到计算机麦克风输入
3. **接地**: 确保计算机和电台有共同的地线连接，减少干扰

## 音频参数设置

### 采样率选择
- **8kHz**: 适合语音通信，文件小，延迟低，推荐用于APRS
- **16kHz**: 提供更好音质，适合高质量APRS信号
- **44.1kHz/48kHz**: 高保真音频，但会增加延迟和文件大小

### 声道设置
- **单声道**: 推荐用于APRS，与电台兼容性好
- **立体声**: 可用于特殊应用，但会增加处理复杂度

### 缓冲区大小
- **256样本**: 低延迟，适合实时APRS
- **512样本**: 平衡延迟和稳定性
- **1024样本**: 高稳定性，但延迟较高

## APRS音频处理功能

### 1. 噪声门限 (Noise Gate)
- **功能**: 自动过滤背景噪声
- **设置**: 默认-40dB，可根据环境调整
- **建议**: 室内环境-35dB，户外环境-45dB

### 2. 动态压缩 (Dynamic Compression)
- **功能**: 控制音频动态范围，确保信号稳定
- **设置**: 默认4:1压缩比
- **建议**: 语音通信2:1，APRS信号4:1

### 3. 峰值限幅 (Peak Limiter)
- **功能**: 防止音频过载，保护电台设备
- **设置**: 默认-3dB门限
- **建议**: 不要低于-6dB，避免过度压缩

## 配置优化建议

### 室内使用
```ini
[audio.input]
gain = 1.0          # 室内环境噪声较低
buffer_size = 256   # 低延迟

[audio.output]
volume = 0.7        # 避免过载
```

### 户外使用
```ini
[audio.input]
gain = 1.5          # 户外环境需要更高增益
buffer_size = 512   # 提高稳定性

[audio.output]
volume = 0.8        # 确保信号强度
```

### 移动使用
```ini
[audio.input]
gain = 1.3          # 平衡增益和噪声
buffer_size = 256   # 保持低延迟

[audio.output]
volume = 0.75       # 平衡音量和稳定性
```

## 故障排除

### 常见问题

1. **音频失真**
   - 检查增益设置，降低输入增益
   - 检查音量设置，降低输出音量
   - 确认音频线连接正确

2. **延迟过高**
   - 减小缓冲区大小
   - 降低采样率
   - 关闭不必要的音频处理

3. **信号质量差**
   - 启用噪声抑制
   - 调整噪声门限
   - 检查音频线质量

4. **电台过载**
   - 降低输出音量
   - 启用峰值限幅
   - 检查音频线阻抗匹配

### 调试步骤

1. **检查音频设备**
   ```bash
   ./aprs_agent
   # 查看列出的音频设备
   ```

2. **测试音频输入**
   - 说话或播放测试音频
   - 观察输入电平指示

3. **测试音频输出**
   - 连接耳机监听输出
   - 确认音频质量

4. **调整参数**
   - 根据测试结果调整增益和音量
   - 优化音频处理参数

## 高级功能

### 实时监控
程序运行时会显示：
- 输入音频电平 (dB)
- 输出音频电平 (dB)
- APRS处理状态
- 限幅次数统计

### 参数调整
运行时可通过配置更新功能调整参数：
```go
// 示例：调整噪声门限
manager.SetAPRSNoiseGate(-35.0)

// 示例：调整压缩比
manager.SetAPRSCompression(3.0)

// 示例：调整峰值门限
manager.SetAPRSPeakThreshold(-2.0)
```

## 安全注意事项

1. **音频电平**: 避免设置过高的增益和音量，防止设备损坏
2. **接地**: 确保设备正确接地，避免电击和干扰
3. **阻抗匹配**: 使用合适的音频线，确保阻抗匹配
4. **测试**: 首次使用前进行充分测试，确认设置正确

## 技术支持

如遇到问题，请：
1. 检查配置文件设置
2. 查看程序日志输出
3. 确认硬件连接正确
4. 参考故障排除指南

---

**注意**: 本系统专为业余无线电使用设计，请遵守相关法规，确保安全使用。

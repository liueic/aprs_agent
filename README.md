# APRS Agent - 业余无线电APRS音频控制系统

这是一个专为业余无线电APRS应用设计的Go语言音频控制系统，可以控制计算机内的麦克风和声卡，实现程序内声音的读取和发送，特别适用于通过耳机线连接到电台进行APRS信号发射。

## 功能特性

- 🎤 **APRS音频输入控制**: 支持麦克风/电台音频捕获，优化8kHz采样率，单声道配置
- 🔊 **电台音频输出控制**: 支持耳机线输出到电台，精确音量控制，防止过载
- ⚙️ **APRS专用配置**: 通过 `app.conf` 配置文件自定义音频接口和参数，针对业余无线电优化
- 🔍 **设备管理**: 自动检测和列出系统可用的音频设备
- 📊 **实时音频监控**: 实时显示音频输入输出级别，APRS专用电平指示
- 🎛️ **APRS音频处理**: 噪声门限、动态压缩、峰值限幅等专业音频处理功能

## 系统要求

- Go 1.21 或更高版本
- macOS (已测试), Linux, Windows
- 音频设备 (麦克风、耳机线接口)
- 业余无线电设备 (电台、TNC等)

## 安装和运行

### 1. 克隆项目
```bash
git clone <repository-url>
cd aprs_agent
```

### 2. 安装依赖
```bash
go mod tidy
```

### 3. 配置音频设备
编辑 `app.conf` 文件，配置您的音频设备参数（已针对APRS优化）：

```ini
[audio.input]
device_name = ""  # 留空使用默认设备，或指定设备名称
sample_rate = 8000   # 8kHz适合语音通信
channels = 1         # 单声道，适合电台使用
buffer_size = 256    # 小缓冲区减少延迟
gain = 1.2           # 适合电台音频的增益

[audio.output]
device_name = ""  # 留空使用默认设备，或指定设备名称
sample_rate = 8000   # 与输入保持一致
channels = 1         # 单声道，适合电台输入
buffer_size = 256    # 小缓冲区减少延迟
volume = 0.8         # 适合电台输入的音量
```

### 4. 运行程序
```bash
go run main.go
```

## 配置文件说明

### 音频输入设置
- `device_name`: 输入设备名称 (留空使用默认设备)
- `sample_rate`: 采样率 (Hz)
- `channels`: 声道数 (1=单声道, 2=立体声)
- `buffer_size`: 缓冲区大小
- `gain`: 输入增益 (0.0-2.0)

### 音频输出设置
- `device_name`: 输出设备名称 (留空使用默认设备)
- `sample_rate`: 采样率 (Hz)
- `channels`: 声道数
- `buffer_size`: 缓冲区大小
- `volume`: 输出音量 (0.0-1.0)

### 音频处理设置
- `echo_cancellation`: 是否启用回声消除
- `noise_suppression`: 是否启用噪声抑制
- `auto_gain_control`: 是否启用自动增益控制
- `format`: 音频格式 (int16, float32)

### 系统设置
- `log_level`: 日志级别
- `list_devices_on_startup`: 启动时是否列出设备
- `stream_timeout`: 音频流超时时间

## 项目结构

```
aprs_agent/
├── main.go              # 主程序入口
├── app.conf             # 配置文件
├── aprs_example.conf    # APRS专用配置示例
├── APRS_USAGE.md        # APRS使用说明
├── go.mod               # Go模块文件
├── README.md            # 项目说明
├── config/              # 配置管理包
│   └── config.go        # 配置结构和加载逻辑
└── audio/               # 音频控制包
    ├── manager.go       # 音频管理器
    ├── devices.go       # 设备管理
    ├── input.go         # 音频输入
    ├── output.go        # 音频输出
    └── aprs_processor.go # APRS专用音频处理器
```

## 使用示例

### 基本使用
程序启动后会自动：
1. 加载配置文件
2. 检测可用音频设备
3. 启动音频输入流 (麦克风/电台音频)
4. 启动音频输出流 (耳机线到电台)

### APRS专用功能
- **噪声门限**: 自动过滤背景噪声，提高APRS信号质量
- **动态压缩**: 控制音频动态范围，确保信号稳定
- **峰值限幅**: 防止音频过载，保护电台设备
- **实时监控**: 显示音频电平、压缩状态、限幅次数等

### 查看设备列表
程序启动时会自动列出所有可用的音频设备，包括：
- 设备名称和ID
- 设备类型 (输入/输出)
- 支持的采样率和声道数
- 是否为默认设备

### 实时音频监控
程序运行时会实时显示：
- 音频输入级别 (分贝)
- 音频输出级别 (分贝)
- 当前增益和音量设置

## 开发说明

### 依赖包
- `github.com/gen2brain/malgo`: 跨平台音频库
- `github.com/spf13/viper`: 配置管理
- `gopkg.in/yaml.v3`: YAML配置文件支持

### 扩展功能
可以通过以下方式扩展功能：
1. 在 `audio/` 包中添加新的音频处理模块
2. 在 `config/` 包中添加新的配置选项
3. 在 `main.go` 中添加新的控制逻辑

## 故障排除

### 常见问题

1. **找不到音频设备**
   - 检查系统音频设置
   - 确保音频设备已连接并启用
   - 检查程序权限

2. **音频质量差**
   - 调整缓冲区大小
   - 检查采样率设置
   - 启用音频处理功能

3. **程序崩溃**
   - 检查配置文件格式
   - 查看日志输出
   - 确保音频设备支持指定配置

### 调试模式
设置日志级别为 `debug` 可获得更详细的运行信息：

```ini
[system]
log_level = "debug"
```

## 许可证

本项目采用 MIT 许可证。

## 贡献

欢迎提交 Issue 和 Pull Request！

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 GitHub Issue
- 发送邮件至 [your-email@example.com]

---

**注意**: 这是一个音频控制系统，请确保在使用时遵守相关法律法规，不要用于非法录音或侵犯他人隐私。
